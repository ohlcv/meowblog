{% extends 'core/base.html' %}

{% block title %}åšå®¢åˆ—è¡¨ - Meow Blog{% endblock %}

{% block content %}
    <!-- éšè—çš„CSRF tokenï¼Œç”¨äºAJAXè¯·æ±‚ -->
    {% csrf_token %}
    <div class="fade-in-up page-container">
        <div class="blog-header">
            <div class="blog-icon">ğŸ±</div>
            <div>
                <h1 class="blog-title">Meow åšå®¢</h1>
                <p class="blog-subtitle">åˆ†äº«çŸ¥è¯†ï¼Œè®°å½•ç”Ÿæ´»</p>
            </div>
        </div>

        <main>
            <!-- æœç´¢æ¡† -->
            {% include 'components/search_input.html' with name="search" value=search_query placeholder="æœç´¢æ–‡ç« æ ‡é¢˜ã€å†…å®¹æˆ–ä½œè€…..." clear_url=request.path hidden_params=request.GET %}

            <!-- æ’åºé€‰é¡¹ -->
            <div style="margin-bottom: 2rem; padding: 1rem; background: var(--bg-light); border-radius: 0.5rem; border: 1px solid rgba(251, 114, 153, 0.15);">
                <div style="display: flex; align-items: center; justify-content: space-between; gap: 1rem; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
                        <span style="font-weight: 500; color: var(--text-primary);">æ’åºæ–¹å¼ï¼š</span>
                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                            <a href="?{% if search_query %}search={{ search_query }}&{% endif %}sort=default" 
                               class="sort-btn {% if current_sort == 'default' %}sort-btn-active{% else %}sort-btn-inactive{% endif %}" 
                               style="padding: 0.5rem 1rem; border-radius: 0.5rem; text-decoration: none; font-weight: 500; transition: all 0.2s ease; display: inline-flex; align-items: center; gap: 0.25rem;">
                                â¤ï¸ é»˜è®¤
                            </a>
                            <a href="?{% if search_query %}search={{ search_query }}&{% endif %}sort=created" 
                               class="sort-btn {% if current_sort == 'created' %}sort-btn-active{% else %}sort-btn-inactive{% endif %}" 
                               style="padding: 0.5rem 1rem; border-radius: 0.5rem; text-decoration: none; font-weight: 500; transition: all 0.2s ease; display: inline-flex; align-items: center; gap: 0.25rem;">
                                ğŸ“… åˆ›å»ºæ—¶é—´
                            </a>
                            <a href="?{% if search_query %}search={{ search_query }}&{% endif %}sort=updated" 
                               class="sort-btn {% if current_sort == 'updated' %}sort-btn-active{% else %}sort-btn-inactive{% endif %}" 
                               style="padding: 0.5rem 1rem; border-radius: 0.5rem; text-decoration: none; font-weight: 500; transition: all 0.2s ease; display: inline-flex; align-items: center; gap: 0.25rem;">
                                ğŸ”„ æ›´æ–°æ—¶é—´
                            </a>
                            <a href="?{% if search_query %}search={{ search_query }}&{% endif %}sort=likes" 
                               class="sort-btn {% if current_sort == 'likes' %}sort-btn-active{% else %}sort-btn-inactive{% endif %}" 
                               style="padding: 0.5rem 1rem; border-radius: 0.5rem; text-decoration: none; font-weight: 500; transition: all 0.2s ease; display: inline-flex; align-items: center; gap: 0.25rem;">
                                â¤ï¸ ç‚¹èµæ•°
                            </a>
                        </div>
                    </div>
                    {% if user.is_authenticated %}
                        <a href="{% url 'accounts:create_post' %}" class="btn btn-primary" style="padding: 0.5rem 1.5rem; font-weight: 600;">
                            âœï¸ å†™æ–‡ç« 
                        </a>
                    {% endif %}
                </div>
            </div>
            
            <!-- æœç´¢ç»“æœæç¤º -->
            {% if search_query %}
                <div style="margin-bottom: 1rem; padding: 0.75rem 1rem; background: var(--bg-light); border-radius: 0.5rem; border-left: 4px solid var(--primary-color);">
                    <p style="margin: 0; color: var(--text-primary);">
                        ğŸ” æœç´¢ "<strong>{{ search_query }}</strong>" çš„ç»“æœï¼š
                        {% if posts %}
                            æ‰¾åˆ° {{ posts|length }} ç¯‡æ–‡ç« 
                        {% else %}
                            æ²¡æœ‰æ‰¾åˆ°ç›¸å…³æ–‡ç« 
                        {% endif %}
                    </p>
                </div>
            {% endif %}

            {% if posts %}
                <div style="display: flex; flex-direction: column; gap: 0.1rem;">
                    {% for post in posts %}
                        {% include 'blog/includes/post_card.html' with post=post card_style='list' show_author_link=True show_visibility=True show_stats=True show_content_preview=True %}
                    {% endfor %}
                </div>
            {% else %}
                <div class="card" style="text-align: center; padding: 4rem; background: var(--bg-light);">
                    <div style="font-size: 5rem; margin-bottom: 2rem; opacity: 0.6;">
                        {% if search_query %}ğŸ”{% else %}ğŸ“{% endif %}
                    </div>
                    <h3 class="subsection-title" style="color: var(--text-secondary); text-align: center;">
                        {% if search_query %}
                            æ²¡æœ‰æ‰¾åˆ°ç›¸å…³æ–‡ç« 
                        {% else %}
                            è¿˜æ²¡æœ‰ä»»ä½•æ–‡ç« 
                        {% endif %}
                    </h3>
                    <p style="color: var(--text-muted); margin-bottom: 0; font-size: 1.1rem;">
                        {% if search_query %}
                            å°è¯•ä½¿ç”¨å…¶ä»–å…³é”®è¯æœç´¢ï¼Œæˆ–è€… <a href="{% url 'blog:post_list' %}" style="color: var(--primary-color);">æŸ¥çœ‹æ‰€æœ‰æ–‡ç« </a>
                        {% else %}
                            æˆä¸ºç¬¬ä¸€ä¸ªå‘å¸ƒæ–‡ç« çš„äººå§ï¼
                        {% endif %}
                    </p>
                </div>
            {% endif %}
            
            {# åˆ†é¡µ #}
            {% if posts.has_other_pages %}
                <div style="display: flex; justify-content: center; margin-top: 3rem;">
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        {% if posts.has_previous %}
                            <a href="?{% if search_query %}search={{ search_query }}&{% endif %}{% if current_sort != 'default' %}sort={{ current_sort }}&{% endif %}page={{ posts.previous_page_number }}" class="btn btn-secondary" style="padding: 0.75rem 1.5rem;">ä¸Šä¸€é¡µ</a>
                        {% endif %}
                        
                        <span style="padding: 0.75rem 1.5rem; background-color: var(--bg-light); border-radius: 0.5rem; color: var(--text-primary); font-weight: 500;">
                            ç¬¬ {{ posts.number }} é¡µï¼Œå…± {{ posts.paginator.num_pages }} é¡µ
                        </span>
                        
                        {% if posts.has_next %}
                            <a href="?{% if search_query %}search={{ search_query }}&{% endif %}{% if current_sort != 'default' %}sort={{ current_sort }}&{% endif %}page={{ posts.next_page_number }}" class="btn btn-secondary" style="padding: 0.75rem 1.5rem;">ä¸‹ä¸€é¡µ</a>
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        </main>
    </div>
    
    <style>
        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem !important;
            }
            
            .card {
                padding: 1.5rem !important;
            }
        }
    </style>
{% endblock %}