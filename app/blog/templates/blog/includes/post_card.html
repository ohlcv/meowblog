{% load blog_extras %}
{% comment %}
æ–‡ç« å¡ç‰‡å¤ç”¨ç»„ä»¶
å‚æ•°ï¼š
- post: æ–‡ç« å¯¹è±¡
- show_actions: æ˜¯å¦æ˜¾ç¤ºç¼–è¾‘/åˆ é™¤æŒ‰é’® (é»˜è®¤: false)
- show_author_link: æ˜¯å¦æ˜¾ç¤ºä½œè€…é“¾æ¥ (é»˜è®¤: true)
- show_visibility: æ˜¯å¦æ˜¾ç¤ºå¯è§æƒé™ (é»˜è®¤: true)
- show_stats: æ˜¯å¦æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯ (é»˜è®¤: true)
- show_content_preview: æ˜¯å¦æ˜¾ç¤ºå†…å®¹é¢„è§ˆ (é»˜è®¤: true)
- show_read_more: æ˜¯å¦æ˜¾ç¤º"é˜…è¯»å…¨æ–‡"æŒ‰é’® (é»˜è®¤: true)
- card_style: å¡ç‰‡æ ·å¼ç±»å‹ ('list'|'detail'|'profile') (é»˜è®¤: 'list')
{% endcomment %}

<article class="card post-card" style="background: #ffffff; transition: all 0.3s ease; cursor: pointer; position: relative;" onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 8px 25px rgba(0,0,0,0.15)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 20px rgba(0, 0, 0, 0.1)'" data-post-url="{% get_post_url post %}">
    {% if card_style|default:'list' == 'list' %}
        {# åˆ—è¡¨é¡µæ ·å¼ - ç®€æ´ç‰ˆ #}
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
            <div style="flex: 1;">
                <h2 class="subsection-title">
                    <a href="{% get_post_url post %}" style="color: #2c3e50; text-decoration: none; transition: color 0.3s ease;" onmouseover="this.style.color='#667eea'" onmouseout="this.style.color='#2c3e50'">{{ post.title }}</a>
                </h2>
                
                {# ä½œè€…å¤´åƒå’Œå…ƒæ•°æ®å¹¶æ’æ˜¾ç¤º #}
                <div style="margin-bottom: 0.75rem; display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        {% include 'blog/includes/user_avatar.html' with user=post.author size='small' current_user=user is_following=post.is_following show_follow_button=true link_to_profile=True %}
                    </div>
                    <div style="flex: 1; min-width: 0;">
                        {% include 'blog/includes/post_metadata.html' with post=post %}
                    </div>
                </div>
                
                {% if show_content_preview %}
                    {% if post.text_preview %}
                        <p style="margin: 0; color: #555; line-height: 1.7; font-size: 1.05rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis;">{{ post.text_preview }}</p>
                    {% else %}
                        <p style="margin: 0; color: #555; line-height: 1.7; font-size: 1.05rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis;">{{ post.content|truncatewords:30 }}</p>
                    {% endif %}
                {% endif %}
            </div>
            
            {% if show_actions %}
            <div style="display: flex; flex-direction: row; gap: 0.5rem; margin-left: 1rem;" onclick="event.stopPropagation();">
                <a href="{% url 'accounts:edit_post' post_id=post.id %}" class="btn btn-warning" style="padding: 0.5rem 1rem; font-size: 0.9rem;">âœï¸ ç¼–è¾‘</a>
                <a href="{% url 'accounts:delete_post' post_id=post.id %}" class="btn btn-danger" style="padding: 0.5rem 1rem; font-size: 0.9rem;">ğŸ—‘ï¸ åˆ é™¤</a>
            </div>
            {% endif %}
        </div>
        
    {% elif card_style == 'detail' %}
        {# è¯¦æƒ…é¡µæ ·å¼ - å¸¦æ“ä½œæŒ‰é’® #}
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
            <div style="flex: 1;">
                <h2 class="subsection-title">
                    <a href="{% get_post_url post %}" style="color: #2c3e50; text-decoration: none; transition: color 0.3s ease;" onmouseover="this.style.color='#667eea'" onmouseout="this.style.color='#2c3e50'">{{ post.title }}</a>
                </h2>
                
                {# ä½œè€…å¤´åƒå’Œå…ƒæ•°æ®å¹¶æ’æ˜¾ç¤º #}
                <div style="margin-bottom: 0.75rem; display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        {% include 'blog/includes/user_avatar.html' with user=post.author size='small' current_user=user is_following=post.is_following show_follow_button=true link_to_profile=True %}
                    </div>
                    <div style="flex: 1; min-width: 0;">
                        {% include 'blog/includes/post_metadata.html' with post=post %}
                    </div>
                </div>
                
                {% if show_content_preview %}
                    {% if post.text_preview %}
                        <p style="margin: 0; color: #555; line-height: 1.7; font-size: 1.05rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis;">{{ post.text_preview }}</p>
                    {% else %}
                        <p style="margin: 0; color: #555; line-height: 1.7; font-size: 1.05rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis;">{{ post.content|truncatewords:30 }}</p>
                    {% endif %}
                {% endif %}
            </div>
            
            {% if show_actions %}
            <div style="display: flex; flex-direction: row; gap: 0.5rem; margin-left: 1rem;" onclick="event.stopPropagation();">
                <a href="{% url 'accounts:edit_post' post_id=post.id %}" class="btn btn-warning" style="padding: 0.5rem 1rem; font-size: 0.9rem;">âœï¸ ç¼–è¾‘</a>
                <a href="{% url 'accounts:delete_post' post_id=post.id %}" class="btn btn-danger" style="padding: 0.5rem 1rem; font-size: 0.9rem;">ğŸ—‘ï¸ åˆ é™¤</a>
            </div>
            {% endif %}
        </div>
        
        {% if show_read_more %}
        <div style="border-top: 1px solid #e9ecef; padding-top: 1rem; display: flex; justify-content: space-between; align-items: center;" onclick="event.stopPropagation();">
            <a href="{% get_post_url post %}" class="btn btn-primary" style="padding: 0.5rem 1.5rem;">ğŸ“– é˜…è¯»å…¨æ–‡</a>
            {% if show_stats %}
            <div style="display: flex; align-items: center; gap: 1rem; color: #6c757d; font-size: 0.9rem;">
                <span>ğŸ’¬ {{ post.comments.count }} è¯„è®º</span>
                <span>{{ post.word_count }} å­—</span>
            </div>
            {% endif %}
        </div>
        {% endif %}
        
    {% elif card_style == 'profile' %}
        {# ä¸ªäººèµ„æ–™é¡µæ ·å¼ - ç´§å‡‘ç‰ˆ #}
        <h3 style="margin-bottom: 1rem;">
            <a href="{% get_post_url post %}" style="color: #2c3e50; text-decoration: none; transition: color 0.3s ease;" onmouseover="this.style.color='#667eea'" onmouseout="this.style.color='#2c3e50'">{{ post.title }}</a>
        </h3>
        
        {% include 'blog/includes/post_metadata.html' with post=post mode='compact' show_author_link=show_author_link %}
        
        {% if show_content_preview %}
            {% if post.text_preview %}
                <p style="margin: 0; color: #555; line-height: 1.7; font-size: 1rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis;">{{ post.text_preview }}</p>
            {% else %}
                <p style="margin: 0; color: #555; line-height: 1.7; font-size: 1rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis;">{{ post.content|truncatewords:30 }}</p>
            {% endif %}
        {% endif %}
    {% endif %}
</article>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // ä¸ºæ‰€æœ‰æ–‡ç« å¡ç‰‡æ·»åŠ ç‚¹å‡»äº‹ä»¶
    document.querySelectorAll('.post-card').forEach(function(card) {
        card.addEventListener('click', function(e) {
            // å¦‚æœç‚¹å‡»çš„æ˜¯æŒ‰é’®æˆ–é“¾æ¥ï¼Œä¸è§¦å‘å¡ç‰‡è·³è½¬
            if (e.target.tagName === 'BUTTON' || e.target.tagName === 'A' || e.target.closest('button') || e.target.closest('a')) {
                return;
            }
            
            // è·³è½¬åˆ°æ–‡ç« è¯¦æƒ…é¡µ
            const postUrl = this.getAttribute('data-post-url');
            if (postUrl) {
                window.location.href = postUrl;
            }
        });
    });
});
</script>
