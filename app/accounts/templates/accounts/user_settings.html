{% extends 'core/base.html' %}

{% block title %}è´¦æˆ·è®¾ç½® - Meow Blog{% endblock %}

{% block content %}
    <div class="fade-in-up page-container">
        <div class="page-header">
            <div class="page-header-content">
                <div class="page-header-title">
                    <h1 class="page-title">âš™ï¸ è´¦æˆ·è®¾ç½®</h1>
                </div>
                <div class="page-header-actions">
                    <a href="{% url 'accounts:profile_center' %}" class="btn-back">â† è¿”å›ä¸ªäººä¸­å¿ƒ</a>
                </div>
            </div>
        </div>
        
        {# æ˜¾ç¤ºæ¶ˆæ¯ - ç”±å…¨å±€JavaScriptç³»ç»Ÿå¤„ç† #}
        {% if messages %}
            <div style="display: none;">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        {# åˆå¹¶çš„ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ #}
        <div class="card card-gradient-light user-info-card">
            <h2 class="section-title user-info-header">ğŸ‘¤ {{ target_user.username }} çš„è´¦æˆ·ä¿¡æ¯</h2>
            
            {# ç”¨æˆ·å¤´åƒå’ŒåŸºæœ¬ä¿¡æ¯ #}
            <div class="two-column">
                <div class="user-info-avatar">
                    {% include 'blog/includes/user_avatar.html' with user=target_user current_user=user size='large' show_name=True link_to_profile=False %}
                </div>
                
                {# åŸºæœ¬ä¿¡æ¯ç½‘æ ¼ #}
                <div class="user-info-details">
                    <div class="user-info-item">
                        <div class="user-info-label">æ ‡è¯†åï¼ˆç”¨æˆ·åï¼‰</div>
                        <div class="user-info-value">{{ target_user.username }}</div>
                    </div>
                    <div class="user-info-item">
                        <div class="user-info-label">æ˜¾ç¤ºåç§°</div>
                        <div class="user-info-value">{{ target_user.profile.displayname|default:"æœªè®¾ç½®" }}</div>
                    </div>
                    <div class="user-info-item">
                        <div class="user-info-label">é‚®ç®±</div>
                        <div class="user-info-value">{{ target_user.email|default:"æœªè®¾ç½®" }}</div>
                    </div>
                    <div class="user-info-item">
                        <div class="user-info-label">æ‰‹æœºå·</div>
                        <div class="user-info-value">{{ target_user.profile.phone|default:"æœªè®¾ç½®" }}</div>
                    </div>
                </div>
            </div>
            
            {# è´¦æˆ·çŠ¶æ€å’Œæ—¶é—´ä¿¡æ¯ #}
            <div class="status-grid">
                {# è´¦æˆ·çŠ¶æ€ #}
                <div class="status-card">
                    <h4 class="status-card-title">
                        ğŸ”’ è´¦æˆ·çŠ¶æ€
                    </h4>
                    <div class="status-list">
                        <div class="status-item">
                            <span class="status-label">è´¦æˆ·çŠ¶æ€:</span>
                            {% if target_user.is_active %}
                                <span class="status-value success">
                                    âœ“ æ­£å¸¸
                                </span>
                            {% else %}
                                <span class="status-value danger">
                                    âœ— ç¦ç”¨
                                </span>
                            {% endif %}
                        </div>
                        <div class="status-item">
                            <span class="status-label">ç¦è¨€çŠ¶æ€:</span>
                            {% if target_user.profile.is_currently_muted %}
                                <span class="status-value danger">
                                    ğŸ”‡ ç¦è¨€ä¸­
                                </span>
                            {% else %}
                                <span class="status-value success">
                                    âœ“ æ­£å¸¸
                                </span>
                            {% endif %}
                        </div>
                        <div class="status-item">
                            <span class="status-label">å‘˜å·¥æƒé™:</span>
                            {% if target_user.is_staff %}
                                <span class="status-value primary">
                                    â­ æ˜¯
                                </span>
                            {% else %}
                                <span class="status-value secondary">
                                    âœ— å¦
                                </span>
                            {% endif %}
                        </div>
                        <div class="status-item">
                            <span class="status-label">è¶…çº§ç®¡ç†å‘˜:</span>
                            {% if target_user.is_superuser %}
                                <span class="status-value primary">
                                    â­ æ˜¯
                                </span>
                            {% else %}
                                <span class="status-value secondary">
                                    âœ— å¦
                                </span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                {# æ—¶é—´ä¿¡æ¯ #}
                <div class="status-card">
                    <h4 class="status-card-title">
                        â° æ—¶é—´ä¿¡æ¯
                    </h4>
                    <div class="status-list">
                        <div class="status-item">
                            <span class="status-label">æ³¨å†Œæ—¶é—´:</span>
                            <span class="status-value">{{ target_user.date_joined|date:"Yå¹´mæœˆdæ—¥ H:i" }}</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">æœ€åç™»å½•:</span>
                            <span class="status-value">{{ target_user.last_login|date:"Yå¹´mæœˆdæ—¥ H:i" }}</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">æ³¨å†Œæ—¶é•¿:</span>
                            <span class="status-value">{{ target_user.date_joined|timesince }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        {# è®¾ç½®é€‰é¡¹ - æ¨ªå‘å¸ƒå±€ #}
        <div class="page-content">
            <div class="status-grid">
                <div class="card setting-card" data-url="{% if is_own_page %}{% url 'accounts:edit_profile' %}{% else %}{% url 'accounts:edit_profile' %}?user_id={{ target_user.id }}{% endif %}">
                    <div class="setting-card-content">
                        <div class="setting-card-icon">ğŸ“</div>
                        <div class="setting-card-text">
                            <h3 class="setting-card-title">ä¿®æ”¹ä¸ªäººä¿¡æ¯</h3>
                            <p class="setting-card-description">
                                {% if is_own_page %}
                                    æ›´æ–°æ˜¾ç¤ºåç§°ã€é‚®ç®±ã€æ‰‹æœºå·ç­‰åŸºæœ¬ä¿¡æ¯
                                {% else %}
                                    ç®¡ç†å‘˜ç‰¹æƒï¼šä¿®æ”¹ {{ target_user.username }} çš„ä¸ªäººä¿¡æ¯
                                {% endif %}
                            </p>
                        </div>
                    </div>
                    <div class="btn btn-primary btn-full">âœï¸ ä¿®æ”¹ä¿¡æ¯</div>
                </div>
                
                <div class="card setting-card" data-url="{% if is_own_page %}{% url 'accounts:change_password' %}{% else %}{% url 'accounts:change_password' %}?user_id={{ target_user.id }}{% endif %}">
                    <div class="setting-card-content">
                        <div class="setting-card-icon">ğŸ”’</div>
                        <div class="setting-card-text">
                            <h3 class="setting-card-title">ä¿®æ”¹å¯†ç </h3>
                            <p class="setting-card-description">
                                {% if is_own_page %}
                                    è®¾ç½®æ–°å¯†ç ï¼Œä¿æŠ¤è´¦æˆ·å®‰å…¨
                                {% else %}
                                    ç®¡ç†å‘˜ç‰¹æƒï¼šä¿®æ”¹ {{ target_user.username }} çš„å¯†ç 
                                {% endif %}
                            </p>
                        </div>
                    </div>
                    <div class="btn btn-primary btn-full">ğŸ”‘ ä¿®æ”¹å¯†ç </div>
                </div>
                
                {% if is_own_page %}
                <div class="card setting-card" data-url="{% url 'accounts:logout' %}">
                    <div class="setting-card-content">
                        <div class="setting-card-icon">ğŸšª</div>
                        <div class="setting-card-text">
                            <h3 class="setting-card-title">é€€å‡ºç™»å½•</h3>
                            <p class="setting-card-description">
                                å®‰å…¨é€€å‡ºå½“å‰è´¦æˆ·ï¼Œä¿æŠ¤è´¦æˆ·éšç§
                            </p>
                        </div>
                    </div>
                    <div class="btn btn-secondary btn-full">ğŸšª é€€å‡ºç™»å½•</div>
                </div>
                {% endif %}
            </div>
        </div>
        
        {# è´¦æˆ·çŠ¶æ€æ˜¾ç¤ºï¼ˆå¦‚æœæœ‰ç¦è¨€/å°ç¦ï¼‰ #}
        {% if user.profile %}
            {% if user.profile.is_currently_muted or user.profile.is_currently_banned %}
                <div class="warning-card">
                    {% if user.profile.is_currently_banned %}
                        <div class="card-gradient-danger">
                            <h4 class="warning-title">ğŸš« è´¦æˆ·å·²è¢«å°ç¦</h4>
                            <p class="warning-text">
                                <strong>å°ç¦åŸå› ï¼š</strong>{{ user.profile.ban_reason|default:"æ— " }}
                            </p>
                            {% if user.profile.ban_until %}
                                <p class="warning-detail">
                                    <strong>è§£å°æ—¶é—´ï¼š</strong>{{ user.profile.ban_until|date:"Yå¹´mæœˆdæ—¥ H:i" }}
                                </p>
                            {% else %}
                                <p class="warning-detail">
                                    <strong>æ°¸ä¹…å°ç¦</strong>
                                </p>
                            {% endif %}
                        </div>
                    {% elif user.profile.is_currently_muted %}
                        <div class="card-gradient-warning">
                            <h4 class="mute-title">ğŸ”‡ è´¦æˆ·å·²è¢«ç¦è¨€</h4>
                            <p class="mute-text">
                                <strong>ç¦è¨€åŸå› ï¼š</strong>{{ user.profile.mute_reason|default:"æ— " }}
                            </p>
                            {% if user.profile.mute_until %}
                                <p class="mute-detail">
                                    <strong>è§£ç¦æ—¶é—´ï¼š</strong>{{ user.profile.mute_until|date:"Yå¹´mæœˆdæ—¥ H:i" }}
                                </p>
                            {% else %}
                                <p class="mute-detail">
                                    <strong>æ°¸ä¹…ç¦è¨€</strong>
                                </p>
                            {% endif %}
                        </div>
                    {% endif %}
                </div>
            {% endif %}
        {% endif %}
    </div>
    
    <!-- å†…è”æ ·å¼å·²ç§»é™¤ï¼Œä½¿ç”¨ç»Ÿä¸€çš„CSSç»„ä»¶ -->
    
    <script>
        // è´¦æˆ·è®¾ç½®é¡µé¢äº¤äº’åŠŸèƒ½
        const UserSettings = {
            // åˆå§‹åŒ–
            init: function() {
                this.bindCardClickEvents();
            },
            
            // ç»‘å®šå¡ç‰‡ç‚¹å‡»äº‹ä»¶
            bindCardClickEvents: function() {
                const settingCards = document.querySelectorAll('.setting-card');
                settingCards.forEach(card => {
                    card.addEventListener('click', function() {
                        const url = this.getAttribute('data-url');
                        if (url) {
                            window.location.href = url;
                        }
                    });
                });
            }
        };
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            UserSettings.init();
        });
    </script>
{% endblock %}