{% extends 'core/base.html' %}
{% load blog_extras %}

{% block title %}ç®¡ç†é¢æ¿ - Meow Blog{% endblock %}

{% block content %}
    <div class="fade-in-up page-container">
        <div class="page-header">
            <div class="page-header-content">
                <div class="page-header-title">
                    <h1 class="page-title">ğŸ”¨ è¶…çº§ç®¡ç†å‘˜é¢æ¿</h1>
                </div>
                <div class="page-header-actions">
                    <a href="{% url 'accounts:profile_center' %}" class="btn-back">â† è¿”å›ä¸ªäººä¸­å¿ƒ</a>
                </div>
            </div>
        </div>
        
        {# æ˜¾ç¤ºæ¶ˆæ¯ - ç”±å…¨å±€JavaScriptç³»ç»Ÿå¤„ç† #}
        {% if messages %}
            <div style="display: none;">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        {# ç³»ç»Ÿç»Ÿè®¡ #}
        <div class="card stats-card">
            <h2 class="section-title stats-title">ğŸ“ˆ ç³»ç»Ÿç»Ÿè®¡</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-number">{{ total_users }}</div>
                    <div class="stat-label">æ€»ç”¨æˆ·æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">{{ total_posts }}</div>
                    <div class="stat-label">æ€»æ–‡ç« æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">{{ total_comments }}</div>
                    <div class="stat-label">æ€»è¯„è®ºæ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">{{ total_categories }}</div>
                    <div class="stat-label">æ€»åˆ†ç±»æ•°</div>
                </div>
            </div>
        </div>

        {# ç®¡ç†åŠŸèƒ½ - æ¨ªå‘å¸ƒå±€ #}
        <div class="page-content">
            <div class="horizontal-layout">
                <div class="card admin-card" data-url="{% url 'accounts:admin_users' %}">
                    <div class="card-icon">ğŸ‘¥</div>
                    <h3 class="card-title">ç”¨æˆ·ç®¡ç†</h3>
                    <p class="card-description">æŸ¥çœ‹å’Œç®¡ç†æ‰€æœ‰ç”¨æˆ·è´¦æˆ·</p>
                    <div class="btn btn-danger btn-full">ç®¡ç†ç”¨æˆ·</div>
                </div>
                
                <div class="card admin-card" data-url="/admin/">
                    <div class="card-icon">âš™ï¸</div>
                    <h3 class="card-title">Django Admin</h3>
                    <p class="card-description">è¿›å…¥DjangoåŸç”Ÿç®¡ç†åå°</p>
                    <div class="btn btn-secondary btn-full">è¿›å…¥åå°</div>
                </div>
            </div>
        </div>

        {# æœ€è¿‘æ´»åŠ¨ #}
        <div class="status-grid">
            {# æœ€è¿‘æ³¨å†Œç”¨æˆ· #}
            <div>
                <h2 style="margin-bottom: 2rem; color: #2c3e50; font-weight: 600; text-align: center;">ğŸ‘¤ æœ€è¿‘æ³¨å†Œç”¨æˆ·</h2>
                {% if recent_users %}
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        {% for user in recent_users %}
                            <div class="card" style="padding: 1rem; background: white; border-left: 4px solid #28a745;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div style="font-weight: 600; color: #2c3e50;">{{ user.username }}</div>
                                        <div style="color: #6c757d; font-size: 0.9rem;">{{ user.date_joined|date:"å¹´mæœˆdæ—¥ H:i" }}</div>
                                    </div>
                                    {% if user.is_superuser %}
                                        <span style="background: #dc3545; color: white; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.8rem;">ç®¡ç†å‘˜</span>
                                    {% elif user.is_staff %}
                                        <span style="background: #ffc107; color: #212529; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.8rem;">å‘˜å·¥</span>
                                    {% else %}
                                        <span style="background: #28a745; color: white; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.8rem;">ç”¨æˆ·</span>
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="card" style="text-align: center; padding: 2rem; color: #6c757d;">
                        æš‚æ— ç”¨æˆ·
                    </div>
                {% endif %}
            </div>

            {# æœ€è¿‘æ–‡ç«  #}
            <div>
                <h2 style="margin-bottom: 2rem; color: #2c3e50; font-weight: 600; text-align: center;">ğŸ“ æœ€è¿‘æ–‡ç« </h2>
                {% if recent_posts %}
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        {% for post in recent_posts %}
                            {% include 'blog/includes/post_card.html' with post=post card_style='list' show_author_link=True show_visibility=True show_stats=False show_content_preview=False %}
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="card" style="text-align: center; padding: 2rem; color: #6c757d;">
                        æš‚æ— æ–‡ç« 
                    </div>
                {% endif %}
            </div>

            {# æœ€è¿‘è¯„è®º #}
            <div>
                <h2 style="margin-bottom: 2rem; color: #2c3e50; font-weight: 600; text-align: center;">ğŸ’¬ æœ€è¿‘è¯„è®º</h2>
                {% if recent_comments %}
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        {% for comment in recent_comments %}
                            <div class="card" style="padding: 1rem; background: white; border-left: 4px solid #6c757d;">
                                <div>
                                    <div style="font-weight: 600; color: #2c3e50; margin-bottom: 0.25rem;">{{ comment.author.username }}</div>
                                    <div style="color: #495057; font-size: 0.9rem; margin-bottom: 0.5rem;">{{ comment.content|truncatechars:50 }}</div>
                                    <div style="color: #6c757d; font-size: 0.8rem;">
                                        åœ¨ã€Š<a href="{% get_post_url comment.post %}" style="color: #007bff; text-decoration: none;">{{ comment.post.title|truncatechars:20 }}</a>ã€‹Â· {{ comment.created_at|date:"mæœˆdæ—¥" }}
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="card" style="text-align: center; padding: 2rem; color: #6c757d;">
                        æš‚æ— è¯„è®º
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <style>
        .stat-item {
            transition: all 0.3s ease;
        }
        
        .stat-item:hover {
            transform: scale(1.05);
        }
        
        .admin-card {
            position: relative;
        }
        
        .admin-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(220, 53, 69, 0.3);
        }
        
        .admin-card[data-url="/admin/"]:hover {
            box-shadow: 0 10px 30px rgba(108, 117, 125, 0.3);
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem !important;
            }
            
            .card {
                padding: 1.5rem !important;
            }
        }
    </style>
    
    <script>
        // ç®¡ç†é¢æ¿äº¤äº’åŠŸèƒ½æ¨¡å—
        const AdminPanel = {
            // åˆå§‹åŒ–å‡½æ•°
            init: function() {
                this.bindCardClickEvents();
            },
            
            // ç»‘å®šå¡ç‰‡ç‚¹å‡»äº‹ä»¶
            bindCardClickEvents: function() {
                const adminCards = document.querySelectorAll('.admin-card');
                adminCards.forEach(card => {
                    card.addEventListener('click', function() {
                        const url = this.getAttribute('data-url');
                        if (url) {
                            window.location.href = url;
                        }
                    });
                });
            }
        };
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            AdminPanel.init();
        });
    </script>
{% endblock %}