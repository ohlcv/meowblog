{% extends 'core/base.html' %}

{% block title %}
    {% if is_own_page %}
        {% if category %}{{ category.name }} - æ–‡ç« ç®¡ç†{% else %}æœªåˆ†ç±»æ–‡ç« {% endif %} - Meow Blog
    {% else %}
        {% if category %}{{ target_user.username }} çš„ {{ category.name }}{% else %}{{ target_user.username }} çš„æœªåˆ†ç±»æ–‡ç« {% endif %} - Meow Blog
    {% endif %}
{% endblock %}

{% block content %}
    <div class="fade-in-up page-container">
        <div class="page-header">
            <div class="page-header-content">
                <div class="page-header-title">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="font-size: 2.5rem;">
                            {% if category %}
                                ğŸ“‚
                            {% else %}
                                ğŸ“„
                            {% endif %}
                        </div>
                        <div>
                            <h1 class="page-title" style="margin: 0;">
                                {% if is_own_page %}
                                    {% if category %}
                                        {{ category.name }} - æ–‡ç« ç®¡ç†
                                    {% else %}
                                        æœªåˆ†ç±»æ–‡ç« 
                                    {% endif %}
                                {% else %}
                                    {% if category %}
                                        {{ target_user.username }} çš„ {{ category.name }}
                                    {% else %}
                                        {{ target_user.username }} çš„æœªåˆ†ç±»æ–‡ç« 
                                    {% endif %}
                                {% endif %}
                            </h1>
                            <p style="color: #6c757d; font-size: 1.1rem; margin: 0;">
                                {% if is_own_page %}
                                    {% if category %}
                                        ç®¡ç†ã€Œ{{ category.name }}ã€åˆ†ç±»ä¸‹çš„æ–‡ç« 
                                    {% else %}
                                        ç®¡ç†æ²¡æœ‰æŒ‡å®šåˆ†ç±»çš„æ–‡ç« 
                                    {% endif %}
                                {% else %}
                                    {% if category %}
                                        æŸ¥çœ‹ã€Œ{{ category.name }}ã€åˆ†ç±»ä¸‹çš„æ–‡ç« 
                                    {% else %}
                                        æŸ¥çœ‹æ²¡æœ‰æŒ‡å®šåˆ†ç±»çš„æ–‡ç« 
                                    {% endif %}
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>
                <div class="page-header-actions">
                    {% if is_own_page %}
                        <a href="{% url 'accounts:manuscript_management' %}" class="btn-back">â† è¿”å›ç¨¿ä»¶ç®¡ç†</a>
                    {% else %}
                        <a href="{% url 'accounts:user_manuscript_management' user_id=target_user.id %}" class="btn-back">â† è¿”å›ç¨¿ä»¶ç®¡ç†</a>
                    {% endif %}
                </div>
            </div>
        </div>
        
        {# æ˜¾ç¤ºæ¶ˆæ¯ - ç”±å…¨å±€JavaScriptç³»ç»Ÿå¤„ç† #}
        {% if messages %}
            <div style="display: none;">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        {# æ“ä½œæŒ‰é’® - åªåœ¨æŸ¥çœ‹è‡ªå·±çš„é¡µé¢æ—¶æ˜¾ç¤º #}
        {% if is_own_page %}
        <div class="card" style="margin-bottom: 2rem; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                {% if category %}
                    <a href="{% url 'accounts:create_post' category_id=category.id %}" class="btn btn-primary">âœï¸ åœ¨æ­¤åˆ†ç±»ä¸‹æ–°å»ºæ–‡ç« </a>
                    <a href="{% url 'accounts:edit_category' category_id=category.id %}" class="btn btn-warning">âœï¸ ç¼–è¾‘åˆ†ç±»</a>
                {% else %}
                    <a href="{% url 'accounts:create_post' %}" class="btn btn-primary">âœï¸ æ–°å»ºæ–‡ç« </a>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <main>
            {% if posts %}
                <div style="display: flex; flex-direction: column; gap: 0.1rem;">
                    {% for post in posts %}
                        {% include 'blog/includes/post_card.html' with post=post card_style='list' show_actions=is_own_page show_author_link=True show_visibility=True show_stats=True show_content_preview=True %}
                    {% endfor %}
                </div>
            {% else %}
                <div class="card" style="text-align: center; padding: 4rem; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
                    <div style="font-size: 5rem; margin-bottom: 2rem; opacity: 0.6;">
                        {% if category %}
                            ğŸ“‚
                        {% else %}
                            ğŸ“„
                        {% endif %}
                    </div>
                    <h3 class="subsection-title" style="color: #6c757d; text-align: center;">
                        {% if category %}
                            æ­¤åˆ†ç±»ä¸‹è¿˜æ²¡æœ‰æ–‡ç« 
                        {% else %}
                            æ²¡æœ‰æœªåˆ†ç±»çš„æ–‡ç« 
                        {% endif %}
                    </h3>
                    <p style="color: #6c757d; margin-bottom: 2rem; font-size: 1.1rem;">
                        {% if category %}
                            åœ¨ã€Œ{{ category.name }}ã€åˆ†ç±»ä¸‹åˆ›å»ºä½ çš„ç¬¬ä¸€ç¯‡æ–‡ç« å§ï¼
                        {% else %}
                            æ‰€æœ‰æ–‡ç« éƒ½å·²ç»åˆ†ç±»æ•´ç†å¥½äº†ï¼
                        {% endif %}
                    </p>
                    {% if category %}
                        <a href="{% url 'accounts:create_post' category_id=category.id %}" class="btn btn-primary" style="padding: 0.75rem 2rem;">åˆ›å»ºç¬¬ä¸€ç¯‡æ–‡ç« </a>
                    {% else %}
                        <a href="{% url 'accounts:create_post' %}" class="btn btn-primary" style="padding: 0.75rem 2rem;">åˆ›å»ºæ–°æ–‡ç« </a>
                    {% endif %}
                </div>
            {% endif %}
            
            {# åˆ†é¡µ #}
            {% if posts.has_other_pages %}
                <div style="display: flex; justify-content: center; margin-top: 3rem;">
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        {% if posts.has_previous %}
                            {% if category %}
                                <a href="?page={{ posts.previous_page_number }}" class="btn btn-secondary" style="padding: 0.75rem 1.5rem;">ä¸Šä¸€é¡µ</a>
                            {% else %}
                                <a href="{% url 'accounts:category_posts' category_id=0 %}?page={{ posts.previous_page_number }}" class="btn btn-secondary" style="padding: 0.75rem 1.5rem;">ä¸Šä¸€é¡µ</a>
                            {% endif %}
                        {% endif %}
                        
                        <span style="padding: 0.75rem 1.5rem; background-color: #e9ecef; border-radius: 0.5rem; color: #495057; font-weight: 500;">
                            ç¬¬ {{ posts.number }} é¡µï¼Œå…± {{ posts.paginator.num_pages }} é¡µ
                        </span>
                        
                        {% if posts.has_next %}
                            {% if category %}
                                <a href="?page={{ posts.next_page_number }}" class="btn btn-secondary" style="padding: 0.75rem 1.5rem;">ä¸‹ä¸€é¡µ</a>
                            {% else %}
                                <a href="{% url 'accounts:category_posts' category_id=0 %}?page={{ posts.next_page_number }}" class="btn btn-secondary" style="padding: 0.75rem 1.5rem;">ä¸‹ä¸€é¡µ</a>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        </main>
    </div>
    
    <style>
        @media (max-width: 768px) {
            .page-header-content {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .page-header-actions {
                align-self: flex-end;
            }
            
            .card {
                padding: 1.5rem !important;
            }
            
            article .card {
                padding: 1rem !important;
            }
        }
    </style>
{% endblock %}